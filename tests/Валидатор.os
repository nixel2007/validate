#Использовать ".."
#Использовать "."
#Использовать 1testrunner
#Использовать asserts

&Тест
Процедура ВалидацияОграничениеЗаполненоРаботает() Экспорт

	// Дано
	Валидатор = Новый Валидатор;
	ТестовыйОбъект = Новый ТестовыйОбъект;
	ТестовыйОбъект.Поле1 = "Значение1";

	// Когда
	РезультатВалидации = Валидатор.Валидировать(ТестовыйОбъект);

	// Тогда
	Ожидаем.Что(РезультатВалидации).ИмеетДлину(1);

	Нарушение = РезультатВалидации[0];
	Ожидаем.Что(Нарушение.Объект()).Равно(ТестовыйОбъект);
	Ожидаем.Что(Нарушение.ИмяСвойства()).Равно("Поле2");
	Ожидаем.Что(Нарушение.Сообщение()).Равно("Значение не заполнено");
	Ожидаем.Что(Нарушение.Код()).Равно("filled");

КонецПроцедуры

&Тест
Процедура ОграничениеКлючей_ЧислоБольше5_Позитив() Экспорт

	Валидатор = Новый Валидатор;
	Объект = Новый ТестовыйОбъект;
	Объект.Поле1 = "ok";
	Объект.Поле2 = "ok";
	Объект.Поле3 = 0;
	Объект.СоответствиеКлючиБольше5 = Новый Соответствие;
	Объект.СоответствиеКлючиБольше5.Вставить(6, "a");
	Объект.СоответствиеКлючиБольше5.Вставить(10, "b");

	Результат = Валидатор.Валидировать(Объект);
	Ожидаем.Что(Результат).ИмеетДлину(0);

КонецПроцедуры

&Тест
Процедура ОграничениеКлючей_ЧислоБольше5_Негатив() Экспорт

	Валидатор = Новый Валидатор;
	Объект = Новый ТестовыйОбъект;
	Объект.Поле1 = "ok";
	Объект.Поле2 = "ok";
	Объект.Поле3 = 0;
	Объект.СоответствиеКлючиБольше5 = Новый Соответствие;
	Объект.СоответствиеКлючиБольше5.Вставить(6, "a");
	Объект.СоответствиеКлючиБольше5.Вставить(5, "b"); // 5 не > 5, нарушает минимум 6

	Результат = Валидатор.Валидировать(Объект);
	Ожидаем.Что(Результат).ИмеетДлину(1);
	Ожидаем.Что(Результат[0].ИмяСвойства()).Равно("СоответствиеКлючиБольше5");
	Ожидаем.Что(Результат[0].Код()).Равно("min");

КонецПроцедуры

&Тест
Процедура ОграничениеЭлементов_Диапазон_Позитив() Экспорт

	Валидатор = Новый Валидатор;
	Объект = Новый ТестовыйОбъект;
	Объект.Поле1 = "ok";
	Объект.Поле2 = "ok";
	Объект.Поле3 = 0;
	Объект.МассивЧиселСДиапазоном = Новый Массив;
	Объект.МассивЧиселСДиапазоном.Добавить(0);
	Объект.МассивЧиселСДиапазоном.Добавить(5);
	Объект.МассивЧиселСДиапазоном.Добавить(10);

	Результат = Валидатор.Валидировать(Объект);
	Ожидаем.Что(Результат).ИмеетДлину(0);

КонецПроцедуры

&Тест
Процедура ОграничениеЭлементов_Диапазон_Негатив() Экспорт

	Валидатор = Новый Валидатор;
	Объект = Новый ТестовыйОбъект;
	Объект.Поле1 = "ok";
	Объект.Поле2 = "ok";
	Объект.Поле3 = 0;
	Объект.МассивЧиселСДиапазоном = Новый Массив;
	Объект.МассивЧиселСДиапазоном.Добавить(0);
	Объект.МассивЧиселСДиапазоном.Добавить(11); // выходит за max

	Результат = Валидатор.Валидировать(Объект);
	Ожидаем.Что(Результат).ИмеетДлину(1);
	Ожидаем.Что(Результат[0].ИмяСвойства()).Равно("МассивЧиселСДиапазоном");
	Ожидаем.Что(Результат[0].Код()).Равно("max");

КонецПроцедуры

&Тест
Процедура ОграничениеКлючей_СоответствиеЧисла_Позитив() Экспорт

	Валидатор = Новый Валидатор;
	Объект = Новый ТестовыйОбъект;
	Объект.Поле1 = "ok";
	Объект.Поле2 = "ok";
	Объект.Поле3 = 0;
	Объект.СоответствиеЧисловыхКлючей = Новый Соответствие;
	Объект.СоответствиеЧисловыхКлючей.Вставить(1, "a");
	Объект.СоответствиеЧисловыхКлючей.Вставить(2, "b");

	Результат = Валидатор.Валидировать(Объект);
	Ожидаем.Что(Результат).ИмеетДлину(0);

КонецПроцедуры

&Тест
Процедура ОграничениеКлючей_СоответствиеЧисла_Негатив() Экспорт

	Валидатор = Новый Валидатор;
	Объект = Новый ТестовыйОбъект;
	Объект.Поле1 = "ok";
	Объект.Поле2 = "ok";
	Объект.Поле3 = 0;
	Объект.СоответствиеЧисловыхКлючей = Новый Соответствие;
	Объект.СоответствиеЧисловыхКлючей.Вставить(1, "a");
	Объект.СоответствиеЧисловыхКлючей.Вставить("строка", "b"); // неверный тип ключа

	Результат = Валидатор.Валидировать(Объект);
	Ожидаем.Что(Результат).ИмеетДлину(1);
	Ожидаем.Что(Результат[0].ИмяСвойства()).Равно("СоответствиеЧисловыхКлючей");
	Ожидаем.Что(Результат[0].Код()).Равно("type");

КонецПроцедуры

&Тест
Процедура ОграничениеКлючей_Массив_Исключение() Экспорт

	Валидатор = Новый Валидатор;
	Объект = Новый ТестовыйОбъект;
	Объект.Поле1 = "ok";
	Объект.Поле2 = "ok";
	Объект.Поле3 = 0;
	Объект.МассивСОграничениемКлючей = Новый Массив; // ключей у массива нет
	// Добавим элемент, чтобы при итерации с Применение="Ключ" возникло исключение в КандидатПоПрименению
	Объект.МассивСОграничениемКлючей.Добавить(1);

	ПроизошлоИсключение = Ложь;
	Попытка
		Валидатор.Валидировать(Объект);
	Исключение
		ПроизошлоИсключение = Истина;
	КонецПопытки;

	Ожидаем.Что(ПроизошлоИсключение).Равно(Истина);

КонецПроцедуры


&Тест
Процедура МожноПереопределитьСообщениеВалидации() Экспорт

	// Дано
	Валидатор = Новый Валидатор;
	ТестовыйОбъект = Новый ТестовыйОбъект;
	ТестовыйОбъект.Поле2 = "Значение2";

	// Когда
	РезультатВалидации = Валидатор.Валидировать(ТестовыйОбъект);

	// Тогда
	Ожидаем.Что(РезультатВалидации).ИмеетДлину(1);

	Нарушение = РезультатВалидации[0];
	Ожидаем.Что(Нарушение.Объект()).Равно(ТестовыйОбъект);
	Ожидаем.Что(Нарушение.ИмяСвойства()).Равно("Поле1");
	Ожидаем.Что(Нарушение.Сообщение()).Равно("Произвольное сообщение");
	Ожидаем.Что(Нарушение.Код()).Равно("filled");

КонецПроцедуры

&Тест
Процедура ВалидацияОграниченияМинимумРаботает() Экспорт

	// Дано
	Валидатор = Новый Валидатор;
	ТестовыйОбъект = Новый ТестовыйОбъект;
	ТестовыйОбъект.Поле1 = "Значение1";
	ТестовыйОбъект.Поле2 = "Значение1";
	ТестовыйОбъект.Поле3 = -15;

	// Когда
	РезультатВалидации = Валидатор.Валидировать(ТестовыйОбъект);

	// Тогда
	Ожидаем.Что(РезультатВалидации).ИмеетДлину(1);

	Нарушение = РезультатВалидации[0];
	Ожидаем.Что(Нарушение.Объект()).Равно(ТестовыйОбъект);
	Ожидаем.Что(Нарушение.ИмяСвойства()).Равно("Поле3");
	Ожидаем.Что(Нарушение.Сообщение()).Равно("Значение меньше минимального <-10>");
	Ожидаем.Что(Нарушение.Код()).Равно("min");

КонецПроцедуры


&Тест
Процедура ВалидацияОграниченияМаксимумРаботает() Экспорт

	// Дано
	Валидатор = Новый Валидатор;
	ТестовыйОбъект = Новый ТестовыйОбъект;
	ТестовыйОбъект.Поле1 = "Значение1";
	ТестовыйОбъект.Поле2 = "Значение1";
	ТестовыйОбъект.Поле3 = 15;

	// Когда
	РезультатВалидации = Валидатор.Валидировать(ТестовыйОбъект);

	// Тогда
	Ожидаем.Что(РезультатВалидации).ИмеетДлину(1);

	Нарушение = РезультатВалидации[0];
	Ожидаем.Что(Нарушение.Объект()).Равно(ТестовыйОбъект);
	Ожидаем.Что(Нарушение.ИмяСвойства()).Равно("Поле3");
	Ожидаем.Что(Нарушение.Сообщение()).Равно("Значение больше максимального <10>");
	Ожидаем.Что(Нарушение.Код()).Равно("max");

КонецПроцедуры

&Тест
Процедура ВалидацияОграничениеВалидноРаботает() Экспорт

	// Дано
	Валидатор = Новый Валидатор;

	ВложенныйОбъект = Новый ТестовыйОбъект;

	ТестовыйОбъект = Новый ТестовыйОбъект;
	ТестовыйОбъект.Поле1 = "Значение1";
	ТестовыйОбъект.ВложенныйОбъект = ВложенныйОбъект;

	// Когда
	РезультатВалидации = Валидатор.Валидировать(ТестовыйОбъект);

	// Тогда
	Ожидаем.Что(РезультатВалидации).ИмеетДлину(2);

	Нарушение = РезультатВалидации[0];
	Ожидаем.Что(Нарушение.Объект()).Равно(ТестовыйОбъект);
	Ожидаем.Что(Нарушение.ИмяСвойства()).Равно("Поле2");
	Ожидаем.Что(Нарушение.Сообщение()).Равно("Значение не заполнено");
	Ожидаем.Что(Нарушение.Код()).Равно("filled");

	Нарушение = РезультатВалидации[1];
	Ожидаем.Что(Нарушение.Объект()).Равно(ТестовыйОбъект);
	Ожидаем.Что(Нарушение.ИмяСвойства()).Равно("ВложенныйОбъект");
	Ожидаем.Что(Нарушение.Сообщение()).Равно("Значение не валидно");
	Ожидаем.Что(Нарушение.Код()).Равно("valid");

КонецПроцедуры

&Тест
Процедура ВалидацияОграничениеТипРаботает() Экспорт

	// Дано
	Валидатор = Новый Валидатор;
	ТестовыйОбъект = Новый ТестовыйОбъект;
	ТестовыйОбъект.Поле1 = "ok";
	ТестовыйОбъект.Поле2 = "ok";
	ТестовыйОбъект.Поле3 = 0;
	// Поле4 ожидается Число, установим строку
	ТестовыйОбъект.Поле4 = "строка";

	// Когда
	РезультатВалидации = Валидатор.Валидировать(ТестовыйОбъект);

	// Тогда
	Ожидаем.Что(РезультатВалидации).ИмеетДлину(1);

	Нарушение = РезультатВалидации[0];
	Ожидаем.Что(Нарушение.Объект()).Равно(ТестовыйОбъект);
	Ожидаем.Что(Нарушение.ИмяСвойства()).Равно("Поле4");
	Ожидаем.Что(Нарушение.Код()).Равно("type");
	Ожидаем.Что(Нарушение.Сообщение()).Содержит("Тип значения отличается от допустимого <");

КонецПроцедуры

&Тест
Процедура ВалидацияОграничениеТипРазрешаетНеопределено() Экспорт

	// Дано
	Валидатор = Новый Валидатор;
	ТестовыйОбъект = Новый ТестовыйОбъект;
	ТестовыйОбъект.Поле1 = "ok";
	ТестовыйОбъект.Поле2 = "ok";
	ТестовыйОбъект.Поле3 = 0;
	// Поле4 оставляем Неопределено

	// Когда
	РезультатВалидации = Валидатор.Валидировать(ТестовыйОбъект);

	// Тогда
	Ожидаем.Что(РезультатВалидации).ИмеетДлину(0);

КонецПроцедуры

&Тест
Процедура ВалидацияОграничениеТипПропускаетКорректныйТип() Экспорт

	// Дано
	Валидатор = Новый Валидатор;

	// Подготовим валидный вложенный объект
	Вложенный = Новый ТестовыйОбъект;
	Вложенный.Поле1 = "ok";
	Вложенный.Поле2 = "ok";
	Вложенный.Поле3 = 0;
	// Поле4 можно оставить Неопределено (Тип разрешает)

	// Основной объект
	ТестовыйОбъект = Новый ТестовыйОбъект;
	ТестовыйОбъект.Поле1 = "ok";
	ТестовыйОбъект.Поле2 = "ok";
	ТестовыйОбъект.Поле3 = 0;
	ТестовыйОбъект.Поле4 = 123; // корректный тип Число
	ТестовыйОбъект.ВложенныйОбъект = Вложенный;

	// Когда
	РезультатВалидации = Валидатор.Валидировать(ТестовыйОбъект);

	// Тогда
	Ожидаем.Что(РезультатВалидации).ИмеетДлину(0);

КонецПроцедуры

&Тест
Процедура ТипЭлемента_МассивСтрок_Позитив() Экспорт

	Валидатор = Новый Валидатор;
	Объект = Новый ТестовыйОбъект;
	Объект.Поле1 = "ok";
	Объект.Поле2 = "ok";
	Объект.Поле3 = 0;
	Объект.КоллекцияСтрок = Новый Массив;
	Объект.КоллекцияСтрок.Добавить("a");
	Объект.КоллекцияСтрок.Добавить("b");

	Результат = Валидатор.Валидировать(Объект);
	Ожидаем.Что(Результат).ИмеетДлину(0);

КонецПроцедуры

&Тест
Процедура ТипЭлемента_МассивСтрок_Негатив() Экспорт

	Валидатор = Новый Валидатор;
	Объект = Новый ТестовыйОбъект;
	Объект.Поле1 = "ok";
	Объект.Поле2 = "ok";
	Объект.Поле3 = 0;
	Объект.КоллекцияСтрок = Новый Массив;
	Объект.КоллекцияСтрок.Добавить("a");
	Объект.КоллекцияСтрок.Добавить(1); // неверный тип элемента

	Результат = Валидатор.Валидировать(Объект);
	Ожидаем.Что(Результат).ИмеетДлину(1);
	Ожидаем.Что(Результат[0].ИмяСвойства()).Равно("КоллекцияСтрок");
	Ожидаем.Что(Результат[0].Код()).Равно("type");

КонецПроцедуры

&Тест
Процедура ТипЭлемента_СтруктураЧисел_Позитив() Экспорт

	Валидатор = Новый Валидатор;
	Объект = Новый ТестовыйОбъект;
	Объект.Поле1 = "ok";
	Объект.Поле2 = "ok";
	Объект.Поле3 = 0;
	Объект.СтруктураЧисел = Новый Структура;
	Объект.СтруктураЧисел.Вставить("x", 10);
	Объект.СтруктураЧисел.Вставить("y", 20);

	Результат = Валидатор.Валидировать(Объект);
	Ожидаем.Что(Результат).ИмеетДлину(0);

КонецПроцедуры

&Тест
Процедура ТипЭлемента_СтруктураЧисел_Негатив() Экспорт

	Валидатор = Новый Валидатор;
	Объект = Новый ТестовыйОбъект;
	Объект.Поле1 = "ok";
	Объект.Поле2 = "ok";
	Объект.Поле3 = 0;
	Объект.СтруктураЧисел = Новый Структура;
	Объект.СтруктураЧисел.Вставить("x", 10);
	Объект.СтруктураЧисел.Вставить("y", "text"); // неверный тип значения

	Результат = Валидатор.Валидировать(Объект);
	Ожидаем.Что(Результат).ИмеетДлину(1);
	Ожидаем.Что(Результат[0].ИмяСвойства()).Равно("СтруктураЧисел");
	Ожидаем.Что(Результат[0].Код()).Равно("type");

КонецПроцедуры

// ВалидацияОграничениеЗаполненоРаботает();
