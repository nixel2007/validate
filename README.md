# validate

[![Тестирование](https://github.com/nixel2007/validate/actions/workflows/test.yml/badge.svg?branch=master)](https://github.com/nixel2007/validate/actions/workflows/test.yml?query=branch%3Amaster)
[![Quality Gate](https://sonar.openbsl.ru/api/project_badges/measure?project=validate&metric=alert_status)](https://sonar.openbsl.ru/dashboard?id=validate)

Валидация объектов на основе правил-аннотаций для OneScript.

Библиотека позволяет описывать ограничения прямо на свойствах объектов через аннотации и выполнять проверку одним вызовом валидатора. Поддерживается проверка вложенных объектов, настраиваемые сообщения и простое расширение набора правил.

## Требования

- OneScript 1.8.3 или выше

## Установка

- Через OPM (OneScript Package Manager):

```bash
opm install validate
```

- Локально в проект: добавьте зависимость в ваш packagedef:

```bsl
    .ЗависитОт("validate", "0.1.0")
```

## Быстрый старт

Опишите ограничения аннотациями на полях вашего объекта:

```bsl
&Заполнено(Сообщение = "Произвольное сообщение")
Перем Поле1 Экспорт;

&Заполнено
Перем Поле2 Экспорт;

&Минимум(-10)
&Максимум(10)
Перем Поле3 Экспорт;

&Валидно
Перем ВложенныйОбъект Экспорт;

&Тип("Число")
Перем Поле4 Экспорт;
```

Выполните валидацию и выведите ошибки:

```bsl
Валидатор = Новый Валидатор;
Объект = Новый ТестовыйОбъект; // ваш класс с аннотациями

Результат = Валидатор.Валидировать(Объект);
Если Результат.Количество() > 0 Тогда
		Сообщить(Валидатор.ОписаниеОшибокВалидации(Результат));
КонецЕсли;
```

Пример строки в отчете об ошибках:

```
[filled]: Объект: <ТипОбъекта>, Свойство: Поле2, Сообщение: Значение не заполнено
```

## Поддерживаемые аннотации

- `&Заполнено(Сообщение = "...")` — значение поля должно быть заполнено. Код нарушения: `filled`.
- `&Истина` — булево значение должно быть Истина. Код нарушения: `true`.
- `&Ложь` — булево значение должно быть Ложь. Код нарушения: `false`.
- `&Минимум(<число>)` — значение не меньше минимума. Код нарушения: `min`.
- `&Максимум(<число>)` — значение не больше максимума. Код нарушения: `max`.
- `&Тип(<тип>)` — значение должно иметь указанный тип. Код нарушения: `type`.
- `&Валидно` — рекурсивная проверка вложенного объекта. Код нарушения: `valid`.

Сообщение об ошибке можно переопределить параметром `Сообщение` там, где это предусмотрено (например, у `&Заполнено`).

## Расширение и кастомизация

- Конструктор валидатора поддерживает подмену фабрики валидаций и контейнера аннотаций:

```bsl
Валидатор = Новый Валидатор(МояФабрикаВалидаций, МойКонтейнерАннотаций);
```

- По умолчанию используется `СтандартнаяФабрикаВалидаций`, где назначено соответствие аннотаций и классов валидаций (`ВалидацияОграниченияЗаполнено`, `...Минимум`, `...Максимум`, `...Истина`, `...Ложь`, `...Валидно`).
- Можно добавлять собственные аннотации в контейнер и свои реализации классов валидаций/ограничений.

## Запуск тестов

В проект включены авто-тесты на 1testrunner. Запустить можно так:

```bash
oscript tasks/test.os
```

Результаты в формате JUnit сохраняются в каталоге `out`.

### Покрытие кода

Для прогона тестов со сбором покрытия используйте задачу из `tasks/coverage.os`:

```bash
oscript tasks/coverage.os
```

Скрипт сохранит статистику в `out/stat.json` и сформирует отчеты:

- `out/genericCoverage.xml` — Generic Coverage (используется Sonar)
- `out/cobertura.xml` — отчет в формате Cobertura (используется плагином Coverage Gutters в VSCode)

---

## Лицензия

Этот проект лицензируется под лицензией MIT. Подробности см. в файле [LICENSE.md](./LICENSE.md).

